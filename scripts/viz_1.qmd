---
title: "Visualization 1"
subtitle: "DSAN 5200 Final Project"
author: "Sarah Chambers"
date: last-modified
date-format: long
format: html
---

```{r}
install.packages("remotes")
```

```{r}
remove.packages("vegabrite")
remotes::install_github("vegawidget/vegabrite")

```

```{r}
library(vegabrite)

df <- read_csv("processed_data/merged_state_obs.csv")
head(df)
```

```{r}
library(vegabrite)

# Small bar chart test
data.frame(x = 1:3, y = c(10, 20, 30)) %>%
  as_vegaspec() %>%
  vega_mark("bar") %>%
  vega_encoding(
    x = vega_x("x", type = "ordinal"),
    y = vega_y("y", type = "quantitative")
  )

```


```{r}
spec_test <- list(
  `$schema` = "https://vega.github.io/schema/vega-lite/v5.json",
  data = list(values = data.frame(x = 1:5, y = c(3, 5, 2, 8, 4))),
  mark = "bar",
  encoding = list(
    x = list(field = "x", type = "ordinal"),
    y = list(field = "y", type = "quantitative")
  )
)

vegawidget(spec_test)
```
# Viz 1
```{r}
# Create Vega-Lite spec
vega_spec_pop <- list(
  `$schema` = "https://vega.github.io/schema/vega-lite/v5.json",
  description = "Choropleth of total prison population (2022)",
  data = list(values = df),
  transform = list(
    list(
      lookup = "jurisdiction",
      from = list(
        data = list(
          url = "https://raw.githubusercontent.com/vega/vega-datasets/main/data/us-10m.json",
          format = list(type = "topojson", feature = "states")
        ),
        key = "properties.name",
        fields = list("geometry")
      )
    )
  ),
  projection = list(type = "albersUsa"),
  mark = "geoshape",
  encoding = list(
    color = list(field = "total_prison_pop_22", type = "quantitative", title = "Prison Population (2022)"),
    tooltip = list(
      list(field = "jurisdiction", type = "nominal", title = "State"),
      list(field = "total_prison_pop_22", type = "quantitative", title = "Prison Pop")
    )
  )
)

# Render the map
vegawidget(vega_spec_pop)
print("Chunk executed")  # Debug check
```

# Viz 1.1
```{r}
df <- df |> 
  mutate(worker_percent = (num_prison_workers / total_prison_pop_22) * 100)
```

```{r}
vega_spec_worker_pct <- list(
  `$schema` = "https://vega.github.io/schema/vega-lite/v5.json",
  description = "Choropleth of % Inmates Working (2022)",
  data = list(values = df),
  transform = list(
    list(
      lookup = "jurisdiction",
      from = list(
        data = list(
          url = "https://raw.githubusercontent.com/vega/vega-datasets/main/data/us-10m.json",
          format = list(type = "topojson", feature = "states")
        ),
        key = "properties.name",
        fields = list("geometry")
      )
    )
  ),
  projection = list(type = "albersUsa"),
  mark = "geoshape",
  encoding = list(
    color = list(
      field = "worker_percent", type = "quantitative",
      title = "% Working Inmates",
      scale = list(scheme = "blues", naColor = "lightgrey")
    ),
    tooltip = list(
      list(field = "jurisdiction", type = "nominal", title = "State"),
      list(field = "worker_percent", type = "quantitative", title = "% Working", format = ".1f")
    )
  )
)

vegawidget(vega_spec_worker_pct)

```